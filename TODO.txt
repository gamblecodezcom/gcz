GAMBLECODEZ FULL BACKEND + BOT + ADMIN WIRING TODO
(Organized strictly by file path / file name — not by functionality)

=====================================================================
ROOT / INFRA
=====================================================================

/package.json
  - [ ] Define scripts:
        - "dev": ts-node-dev or nodemon for backend
        - "start": node dist/backend/src/server.js
        - "build": tsc
        - "migrate:up": node dist/backend/src/db/migrate.js up
        - "migrate:down": node dist/backend/src/db/migrate.js down
        - "lint": eslint .
  - [ ] Add dependencies:
        - express, cors, helmet, morgan
        - pg (or mysql2) / prisma / knex (pick one)
        - jsonwebtoken
        - axios (for outbound if needed)
  - [ ] Add devDependencies:
        - typescript, ts-node, ts-node-dev
        - @types/node, @types/express
        - eslint, prettier

/tsconfig.json
  - [ ] Configure:
        - "rootDir": "./"
        - "outDir": "./dist"
        - module resolution: "node"
        - "esModuleInterop": true
        - "strict": true

/.env (NOT COMMITTED)
  - [ ] Define:
        - NODE_ENV=production|development
        - PORT=xxxx
        - DB_URL=...
        - TELEGRAM_BOT_TOKEN=...
        - TELEGRAM_BOT_WEBHOOK_SECRET=...
        - DISCORD_BOT_TOKEN=...
        - JWT_SECRET=...
        - ADMIN_PANEL_URL=https://gamblecodez.com/admin
        - FRONTEND_URL=https://gamblecodez.com
        - TELEGRAM_WEBAPP_URL=https://gamblecodez.com/telegram
        - LOG_LEVEL=info|debug

=====================================================================
BACKEND CORE
=====================================================================

/backend/src/server.ts
  - [ ] Import and initialize:
        - express, cors, helmet, morgan
        - env config from ./config/env
        - db connection health check
  - [ ] Setup global middleware:
        - helmet() for basic security headers
        - cors({ origin: [FRONTEND_URL, TELEGRAM_WEBAPP_URL] })
        - express.json({ limit: '1mb' })
        - request logging via morgan
        - requestId generator (optional)
  - [ ] Mount routes:
        - app.get("/health", healthHandler)
        - app.use("/v1", publicApiRouter)
        - app.use("/admin", adminRouter)
        - app.use("/webhooks", webhookRouter)
  - [ ] Global error handler:
        - capture errors, log server side
        - respond with { error: 'Internal server error' }
  - [ ] Start server on PORT
        - log URL and environment

/backend/src/config/env.ts
  - [ ] Implement typed env loader:
        - read process.env
        - validate required keys
        - throw on missing in non-test env
  - [ ] Export:
        - env.PORT
        - env.DB_URL
        - env.TELEGRAM_BOT_TOKEN
        - env.TELEGRAM_BOT_WEBHOOK_SECRET
        - env.DISCORD_BOT_TOKEN
        - env.JWT_SECRET
        - env.ADMIN_PANEL_URL
        - env.FRONTEND_URL
        - env.TELEGRAM_WEBAPP_URL
        - env.LOG_LEVEL

/backend/src/db/index.ts
  - [ ] Create DB client (pg.Pool or chosen ORM client)
  - [ ] Export:
        - db.query(sql, params)
        - db.getClient()
        - async checkConnection(): run 'SELECT 1'
  - [ ] Ensure proper logging of connection errors

/backend/src/db/migrations/2025_01_init.sql
  - [ ] Create tables:
        - users
            id (pk, uuid or bigserial)
            telegram_id (unique nullable)
            telegram_username
            discord_id (unique nullable)
            discord_username
            cwallet_id (unique nullable)
            email (unique nullable)
            created_at (timestamptz, default now())
            updated_at (timestamptz, default now())
        - drops
            id (pk)
            title
            description
            drop_type (enum: 'sc', 'crypto', 'promo')
            status (enum: 'draft', 'active', 'paused', 'completed')
            max_claims (int)
            start_at (timestamptz)
            end_at (timestamptz)
            created_by_admin_id (fk -> users or admins)
            created_at
            updated_at
        - drop_claims
            id (pk)
            drop_id (fk -> drops)
            user_id (fk -> users)
            source (enum: 'web', 'telegram', 'discord')
            claimed_at (timestamptz, default now())
            status (enum: 'pending', 'confirmed', 'rejected')
            tx_hash (nullable)
        - newsletter_subscriptions
            id (pk)
            email
            source (enum: 'web', 'telegram', 'discord')
            is_active (boolean)
            created_at
            unsubscribed_at (nullable)
        - telegram_events
            id (pk)
            update_id
            type
            payload_json (jsonb)
            created_at
        - discord_events
            id (pk)
            event_id
            type
            payload_json (jsonb)
            created_at
        - admins
            id (pk, fk -> users or standalone)
            email (unique)
            role (enum: 'superadmin', 'mod')
            created_at
            updated_at
  - [ ] Add constraints:
        - UNIQUE (drop_id, user_id) on drop_claims
        - INDEX users(telegram_id), users(discord_id), users(cwallet_id)
        - INDEX drops(status, start_at, end_at)

/backend/src/db/migrate.ts
  - [ ] Implement migration runner:
        - read ./migrations/*.sql ordered by filename
        - table schema_migrations(version, applied_at)
        - up: run new files, record in table
        - down: optional – only allow in dev/test
  - [ ] CLI entry:
        - node dist/backend/src/db/migrate.js up|down

=====================================================================
BACKEND ROUTERS (PUBLIC)
=====================================================================

/backend/src/routes/index.ts
  - [ ] Export combined router:
        - import dropsRouter from "./drops"
        - import newsletterRouter from "./newsletter"
        - import profileRouter from "./profile"
  - [ ] mount:
        - router.use("/drops", dropsRouter)
        - router.use("/newsletter", newsletterRouter)
        - router.use("/profile", profileRouter)

/backend/src/routes/drops.ts
  - [ ] Routes:
        - GET /v1/drops
            -> listActiveDrops()
            -> optional user context (claimed / not claimed)
        - GET /v1/drops/:id
            -> getDrop()
        - POST /v1/drops/claim
            -> auth: from JWT or telegram/discord mapping
            -> call dropService.claimDrop()
  - [ ] Validate:
        - drop exists, active, not expired
        - user within claim limit
  - [ ] Return:
        - drop info, claim result, status

/backend/src/routes/newsletter.ts
  - [ ] POST /v1/newsletter/subscribe
        - body: { email, source }
        - validate email
        - upsert into newsletter_subscriptions (is_active=true)
  - [ ] POST /v1/newsletter/unsubscribe
        - body: { email }
        - set is_active=false, unsubscribed_at=now()

/backend/src/routes/profile.ts
  - [ ] GET /v1/profile
        - require auth (telegram/discord/JWT)
        - return user info + claims + active drops summary
  - [ ] POST /v1/profile/cwallet
        - body: { cwallet_id }
        - validate format
        - link via userService.linkCwallet()

=====================================================================
WEBHOOK ROUTERS
=====================================================================

/backend/src/routes/webhooks/index.ts
  - [ ] Router combining:
        - POST /webhooks/telegram
        - POST /webhooks/discord

/backend/src/routes/webhooks/telegram.ts
  - [ ] Validate webhook secret:
        - header or URL token matched to env.TELEGRAM_BOT_WEBHOOK_SECRET
  - [ ] Parse Telegram update:
        - message, callback_query, inline_query, etc.
  - [ ] Log update into telegram_events for audit
  - [ ] Dispatch to telegramHandler:
        - handleTelegramCommand(update)
        - handleTelegramCallback(update)
        - handleTelegramWebAppData(update)
  - [ ] Respond quickly (200 OK)

/backend/src/routes/webhooks/discord.ts
  - [ ] Validate Discord request (signature or token)
  - [ ] Parse interaction payload
  - [ ] Log into discord_events
  - [ ] Dispatch to discordHandler:
        - handleDiscordSlashCommand(event)
        - handleDiscordButton(event)

=====================================================================
SERVICES
=====================================================================

/backend/src/services/userService.ts
  - [ ] Implement:
        - async findOrCreateByTelegram(telegramId, username)
        - async findOrCreateByDiscord(discordId, username)
        - async linkCwallet(userId, cwalletId)
        - async getUserById(userId)
        - async getProfile(userId):
            -> user, claims, aggregated stats

/backend/src/services/dropService.ts
  - [ ] Implement:
        - async listActiveDrops(userId?)
            -> from drops where status='active' and now between start/end
            -> optional join on drop_claims to tag claimed
        - async getDrop(dropId, userId?)
        - async claimDrop({ userId, dropId, source })
            -> transaction:
                - verify drop active
                - verify not already claimed (unique constraint)
                - verify < max_claims
                - insert drop_claims row
        - async createDrop(payload) (for admin)

/backend/src/services/newsletterService.ts
  - [ ] Implement:
        - async subscribe(email, source)
        - async unsubscribe(email)
        - helper to validate email/pattern

/backend/src/services/authService.ts
  - [ ] Implement:
        - issueUserJWT(userId)
        - verifyJWT(token)
        - mapTelegramWebAppData(initData) -> userId
        - mapDiscordToken / OAuth data -> userId

=====================================================================
MIDDLEWARE
=====================================================================

/backend/src/middleware/auth.ts
  - [ ] Implement:
        - requireAdmin(req, res, next)
            -> verify JWT
            -> ensure user has admin record
        - requireUserFromJWT
        - requireUserFromTelegramWebApp
            -> verify Telegram initData hash (Telegram WebApp auth)
            -> resolve to user
        - requireUserFromDiscord
            -> verify Discord auth token and map to user

/backend/src/middleware/errorHandler.ts
  - [ ] Central error middleware:
        - capture errors
        - log (without leaking sensitive data)
        - respond with generic 500

/backend/src/middleware/logging.ts
  - [ ] Optional:
        - attach requestId
        - log method, path, status, duration

=====================================================================
TELEGRAM BOT
=====================================================================

/backend/src/telegram/bot.ts
  - [ ] Configure Telegram bot instance with TELEGRAM_BOT_TOKEN
  - [ ] Set webhook URL to /webhooks/telegram (or via separate script)
  - [ ] Implement:
        - handleTelegramCommand(update)
            - /start:
                -> welcome
                -> link to site, Mini App, Cwallet invite
            - /profile:
                -> call userService + dropService
            - /drops:
                -> listActiveDrops()
            - /help:
                -> link to support/TOS frontend page
        - handleTelegramCallback(update)
            - parse callback_data (e.g. "CLAIM_DROP_<id>")
            - call dropService.claimDrop()
        - handleTelegramWebAppData(update)
            - parse web_app_data
            - verify via Telegram WebApp auth
            - map to user

/backend/src/telegram/commands.ts
  - [ ] Command handlers:
        - startCommand(ctx)
        - profileCommand(ctx)
        - dropsCommand(ctx)
        - helpCommand(ctx)

/backend/src/telegram/keyboards.ts
  - [ ] Inline keyboards for:
        - drops list
        - claim buttons
        - open webapp buttons

=====================================================================
DISCORD BOT
=====================================================================

/backend/src/discord/bot.ts
  - [ ] Initialize Discord client with DISCORD_BOT_TOKEN
  - [ ] Register slash commands:
        - /drops: list active drops
        - /claim [dropId]: claim drop
        - /link_cwallet [id]: link Cwallet
        - /help: link support/TOS
  - [ ] Wire event listeners:
        - ready
        - interactionCreate
  - [ ] Use dropService and userService for logic

/backend/src/discord/commands.ts
  - [ ] Implement per-command handlers:
        - handleDropsCommand(interaction)
        - handleClaimCommand(interaction)
        - handleLinkCwalletCommand(interaction)
        - handleHelpCommand(interaction)

=====================================================================
ADMIN BACKEND
=====================================================================

/backend/src/admin/index.ts
  - [ ] Export router:
        - import dropsAdminRouter
        - import dashboardRouter

/backend/src/admin/routes/drops.ts
  - [ ] Routes (secured by requireAdmin):
        - GET /admin/drops
            -> list all drops with filters (status, type, date)
        - POST /admin/drops
            -> create new drop
        - PATCH /admin/drops/:id
            -> update title, description, type, status, dates, max_claims

/backend/src/admin/routes/dashboard.ts
  - [ ] GET /admin/dashboard/summary
        - aggregate:
            - total users
            - total drops
            - total claims
            - claims by source (web/telegram/discord)
            - lastX days metrics

=====================================================================
CRON / WORKERS
=====================================================================

/workers/cron/expireDrops.ts
  - [ ] Script:
        - find drops where end_at < now() and status='active'
        - update status='completed'
        - optionally log actions

/workers/cron/metricsSnapshot.ts
  - [ ] Script:
        - compute nightly metrics snapshot
        - insert into metrics_snapshots table

=====================================================================
FRONTEND (KEY FILES)
=====================================================================

/frontend/pages/support-tos.html
  - [ ] Already contains:
        - support
        - TOS
        - VPN info
        - Cwallet info
        - privacy & telegram privacy
        - unsubscribe instructions
  - [ ] Wire:
        - ensure all href links are correct and HTTPS
        - add this page to:
            - main nav link: “Support / Terms”
            - footer link: “Support / TOS / Privacy”

/frontend/src/components/Footer.tsx (or similar)
  - [ ] Add link:
        - <a href="/support-tos.html">Support / TOS / Privacy</a>

/frontend/src/pages/admin/DropsDashboard.tsx
  - [ ] Fetch:
        - GET /admin/drops
        - GET /admin/dashboard/summary
  - [ ] Render:
        - table of drops with create/edit
        - summary cards for metrics
  - [ ] Auth:
        - require admin JWT; redirect to login if missing

/frontend/src/pages/telegram-landing.tsx
  - [ ] Content:
        - top: GCZ logo + neon
        - explain Telegram bot, Mini App, Cwallet
        - buttons:
            - Open Telegram Bot
            - Open Telegram Mini App
            - Create Cwallet
            - View Support / TOS
  - [ ] Style using neon theme CSS

=====================================================================
DEPLOYMENT / OPS
=====================================================================

/Dockerfile
  - [ ] Multi-stage:
        - build stage: install deps, run tsc
        - run stage: node dist/backend/src/server.js
  - [ ] Ensure node_modules for prod only in final

/docker-compose.yml (if used)
  - [ ] Services:
        - app (backend)
        - db (postgres)
        - admin-frontend (optional)
  - [ ] Health checks:
        - app: curl /health
        - db: postgres check

/k8s/ (if Kubernetes)
  - [ ] Deployment:
        - env from secret
        - liveness + readiness using /health
  - [ ] Service:
        - expose HTTP(s)
  - [ ] Ingress:
        - map gamblecodez.com to frontend & backend

=====================================================================
FINAL CHECKLIST
=====================================================================

  - [ ] Migrations run successfully in dev
  - [ ] /health returns 200 and DB OK
  - [ ] /v1/drops returns active drops
  - [ ] /v1/drops/claim works with mocked user
  - [ ] Telegram webhook set and receiving events
  - [ ] Discord bot online and responding to /help
  - [ ] Admin panel reachable and secured
  - [ ] Support/TOS page deployed and linked in header/footer
  - [ ] Newsletter subscribe + unsubscribe endpoints wired and tested
  - [ ] Logs showing claims, errors, and events clearly


GAMBLECODEZ FULL BACKEND + BOT + ADMIN WIRING TODO
(Organized strictly by file path / file name — not by functionality)

=====================================================================
ROOT / INFRA
=====================================================================

/package.json
  - [ ] Define scripts:
        - "dev": ts-node-dev or nodemon for backend
        - "start": node dist/backend/src/server.js
        - "build": tsc
        - "migrate:up": node dist/backend/src/db/migrate.js up
        - "migrate:down": node dist/backend/src/db/migrate.js down
        - "lint": eslint .
  - [ ] Add dependencies:
        - express, cors, helmet, morgan
        - pg (or mysql2) / prisma / knex (pick one)
        - jsonwebtoken
        - axios
        - (optional) telegraf / node-telegram-bot-api
        - (optional) discord.js
  - [ ] Add devDependencies:
        - typescript, ts-node, ts-node-dev
        - @types/node, @types/express
        - eslint, prettier

/tsconfig.json
  - [ ] Configure:
        - "rootDir": "./"
        - "outDir": "./dist"
        - "moduleResolution": "node"
        - "esModuleInterop": true
        - "strict": true

/.env (NOT COMMITTED)
  - [ ] Define:
        - NODE_ENV=production|development
        - PORT=xxxx
        - DB_URL=...
        - TELEGRAM_BOT_TOKEN=...
        - TELEGRAM_BOT_WEBHOOK_SECRET=...
        - DISCORD_BOT_TOKEN=...
        - JWT_SECRET=...
        - ADMIN_PANEL_URL=https://gamblecodez.com/admin
        - FRONTEND_URL=https://gamblecodez.com
        - TELEGRAM_WEBAPP_URL=https://gamblecodez.com/telegram
        - LOG_LEVEL=info|debug

=====================================================================
BACKEND CORE
=====================================================================

/backend/src/server.ts
  - [ ] Import and initialize:
        - express, path, cors, helmet, morgan
        - env config from ./config/env
        - db connection health check
  - [ ] Setup global middleware:
        - helmet()
        - cors({ origin: [FRONTEND_URL, TELEGRAM_WEBAPP_URL] })
        - express.json({ limit: '1mb' })
        - morgan('combined') or custom logger
        - requestId generator (optional)
  - [ ] Static/frontend wiring:
        - serve support/TOS page:
            app.use("/static", express.static("/var/www/gamblecodez/pages"))
            app.get("/support-tos", (req, res) =>
                res.sendFile("/var/www/gamblecodez/pages/support-tos.html")
            )
  - [ ] Mount routes:
        - app.get("/health", healthHandler)
        - app.use("/v1", publicApiRouter)        // drops, newsletter, profile, promos
        - app.use("/admin", adminRouter)         // admin APIs
        - app.use("/webhooks", webhookRouter)    // telegram + discord webhooks
  - [ ] Global error handler:
        - capture errors, log server side
        - respond with { error: 'Internal server error' }
  - [ ] Start server on PORT with logging

/backend/src/config/env.ts
  - [ ] Implement typed env loader:
        - validate all required envs
  - [ ] Export config object (no raw process.env usage elsewhere)

/backend/src/db/index.ts
  - [ ] Create DB client (pg.Pool or ORM client)
  - [ ] Export:
        - db.query
        - db.getClient
        - async checkConnection()

/backend/src/db/migrations/2025_01_init.sql
  - [ ] Create tables:
        - users
            id (pk)
            telegram_id (unique nullable)
            telegram_username
            discord_id (unique nullable)
            discord_username
            cwallet_id (unique nullable)
            email (unique nullable)
            is_admin (boolean default false) OR separate admins table
            created_at
            updated_at
        - drops
            id (pk)
            title
            description
            drop_type ('sc', 'crypto', 'promo')
            status ('draft', 'active', 'paused', 'completed')
            max_claims (int)
            start_at
            end_at
            created_by_admin_id (fk -> users/admins)
            created_at
            updated_at
        - drop_claims
            id (pk)
            drop_id (fk -> drops)
            user_id (fk -> users)
            source ('web', 'telegram', 'discord')
            claimed_at
            status ('pending', 'confirmed', 'rejected')
            tx_hash (nullable)
        - newsletter_subscriptions
            id (pk)
            email
            source ('web', 'telegram', 'discord')
            is_active (boolean)
            created_at
            unsubscribed_at (nullable)
        - promos  (user-submitted / admin-curated promos)
            id (pk)
            promo_name
            promo_code_or_link
            casino_base_url           -- ex: winna.com
            promo_type ('code', 'link')
            vip_or_wager_requirements text
            claim_rules_json          -- JSON describing time windows / limited claims
            notes                     -- internal admin notes
            status ('pending_review', 'approved', 'rejected')
            submitted_by_user_id (nullable, fk -> users)
            created_at
            updated_at
        - telegram_events
            id (pk)
            update_id
            type
            payload_json
            created_at
        - discord_events
            id (pk)
            event_id
            type
            payload_json
            created_at
        - admins (if separate)
            id (pk)
            user_id (fk -> users)
            role ('superadmin', 'mod')
            created_at
            updated_at
  - [ ] Add constraints:
        - UNIQUE (drop_id, user_id) on drop_claims
        - UNIQUE on users(telegram_id), users(discord_id), users(cwallet_id), users(email)
        - INDEX drops(status, start_at, end_at)
        - INDEX promos(status, casino_base_url)

/backend/src/db/migrate.ts
  - [ ] Implement migration runner:
        - schema_migrations table
        - up/down commands
        - prevent destructive down in production

=====================================================================
BACKEND ROUTERS (PUBLIC)
=====================================================================

/backend/src/routes/index.ts
  - [ ] Combine routers:
        - router.use("/drops", dropsRouter)
        - router.use("/newsletter", newsletterRouter)
        - router.use("/profile", profileRouter)
        - router.use("/promos", promosRouter)

/backend/src/routes/drops.ts
  - [ ] GET /v1/drops
        - listActiveDrops(userId?)
  - [ ] GET /v1/drops/:id
        - getDrop(dropId, userId?)
  - [ ] POST /v1/drops/claim
        - require user (JWT/telegram/discord)
        - call dropService.claimDrop()
        - return claim result, status

/backend/src/routes/newsletter.ts
  - [ ] POST /v1/newsletter/subscribe
        - body: { email, source }
        - validate email
        - newsletterService.subscribe()
  - [ ] POST /v1/newsletter/unsubscribe
        - body: { email }
        - newsletterService.unsubscribe()

/backend/src/routes/profile.ts
  - [ ] GET /v1/profile
        - require user auth
        - userService.getProfile()
  - [ ] POST /v1/profile/cwallet
        - body: { cwallet_id }
        - userService.linkCwallet()

/backend/src/routes/promos.ts
  - [ ] POST /v1/promos/submit
        - for user-submitted promos via "Donate / Submit Promo" form
        - body:
            promo_name
            promo_code_or_link
            casino_base_url          // ex: winna.com
            promo_type               // 'code' or 'link'
            vip_or_wager_requirements
            claim_rules_json or:
                - is_claimable_now (boolean)
                - time_window_desc (string)
                - has_limited_claims (boolean)
        - require user context (if logged in) OR allow anonymous with rate limit
        - store row in promos with status='pending_review'
  - [ ] GET /v1/promos/approved
        - returns approved promos for public display (optional)

=====================================================================
WEBHOOK ROUTERS
=====================================================================

/backend/src/routes/webhooks/index.ts
  - [ ] router.post("/telegram", telegramWebhookHandler)
  - [ ] router.post("/discord", discordWebhookHandler)

/backend/src/routes/webhooks/telegram.ts
  - [ ] Validate webhook secret/token
  - [ ] Parse update, log to telegram_events
  - [ ] Pass to telegram/bot.ts handlers

/backend/src/routes/webhooks/discord.ts
  - [ ] Validate Discord request
  - [ ] Parse interaction, log to discord_events
  - [ ] Pass to discord/bot.ts handlers

=====================================================================
SERVICES
=====================================================================

/backend/src/services/userService.ts
  - [ ] findOrCreateByTelegram(telegramId, username)
  - [ ] findOrCreateByDiscord(discordId, username)
  - [ ] linkCwallet(userId, cwalletId)
  - [ ] getUserById(userId)
  - [ ] getProfile(userId) -> user, claims, active drops snapshot

/backend/src/services/dropService.ts
  - [ ] listActiveDrops(userId?)
  - [ ] getDrop(dropId, userId?)
  - [ ] claimDrop({ userId, dropId, source })
  - [ ] createDrop(payload)   // for admin
  - [ ] updateDrop(payload)   // for admin editing

/backend/src/services/newsletterService.ts
  - [ ] subscribe(email, source)
  - [ ] unsubscribe(email)
  - [ ] isSubscribed(email) (optional)

/backend/src/services/promoService.ts
  - [ ] submitPromo(payload)
        - normalize casino_base_url to bare domain (strip query params)
        - mark status='pending_review'
  - [ ] listPromosByStatus(status)
  - [ ] approvePromo(promoId, adminId)
  - [ ] rejectPromo(promoId, adminId)

/backend/src/services/authService.ts
  - [ ] issueUserJWT(userId)
  - [ ] verifyJWT(token)
  - [ ] mapTelegramWebAppData(initData) -> userId
  - [ ] mapDiscordIdentity(...) -> userId

=====================================================================
MIDDLEWARE
=====================================================================

/backend/src/middleware/auth.ts
  - [ ] requireAdmin
  - [ ] requireUserFromJWT
  - [ ] requireUserFromTelegramWebApp
  - [ ] requireUserFromDiscord

/backend/src/middleware/errorHandler.ts
  - [ ] global error handler

/backend/src/middleware/logging.ts
  - [ ] optional request logging / requestId

=====================================================================
TELEGRAM BOT
=====================================================================

/backend/src/telegram/bot.ts
  - [ ] Initialize bot with TELEGRAM_BOT_TOKEN
  - [ ] Wire update handling from webhook
  - [ ] Use commands + keyboards modules

/backend/src/telegram/commands.ts
  - [ ] /start
        - explain GCZ
        - send buttons:
            - Open Site (https://gamblecodez.com)
            - Support / TOS (https://gamblecodez.com/support-tos)
            - Open Mini App (TELEGRAM_WEBAPP_URL)
  - [ ] /profile
        - show linked Cwallet, claim stats, active drops count
  - [ ] /drops
        - show listActiveDrops with inline buttons (Claim / View)
  - [ ] /help
        - link to Support / TOS page
  - [ ] /submitpromo (or /donatepromo)
        - start conversation:
            ask promo_name
            ask promo_link_or_code
            ask casino_base_url (no tracking params)
            ask vip/wager requirements
            ask claimability (now / specific times / limited claims)
        - call promoService.submitPromo() with answers
        - confirm to user that admin will review

/backend/src/telegram/keyboards.ts
  - [ ] Inline keyboards for:
        - each drop (Claim / Details)
        - open webapp button
        - quick “Submit Promo” button linking to /submitpromo or web form

=====================================================================
DISCORD BOT
=====================================================================

/backend/src/discord/bot.ts
  - [ ] Initialize client
  - [ ] Register slash commands:
        - /drops
        - /claim [dropId]
        - /help
        - /submitpromo
  - [ ] On interactionCreate:
        - route to commands handlers

/backend/src/discord/commands.ts
  - [ ] handleDropsCommand
  - [ ] handleClaimCommand
  - [ ] handleHelpCommand (link to Support / TOS)
  - [ ] handleSubmitPromoCommand:
        - prompt user for promo details via follow-up messages
        - collect:
            promo_name
            promo_code_or_link
            casino_base_url
            vip_or_wager_requirements
            claimability description
        - call promoService.submitPromo()

=====================================================================
ADMIN BACKEND
=====================================================================

/backend/src/admin/index.ts
  - [ ] router.use("/drops", dropsAdminRouter)
  - [ ] router.use("/dashboard", dashboardRouter)
  - [ ] router.use("/promos", promosAdminRouter)

/backend/src/admin/routes/drops.ts
  - [ ] GET /admin/drops
  - [ ] POST /admin/drops
  - [ ] PATCH /admin/drops/:id

/backend/src/admin/routes/dashboard.ts
  - [ ] GET /admin/dashboard/summary

/backend/src/admin/routes/promos.ts
  - [ ] GET /admin/promos
        - list by status (pending_review, approved, rejected)
  - [ ] PATCH /admin/promos/:id/approve
        - set status='approved'
  - [ ] PATCH /admin/promos/:id/reject
        - set status='rejected'
  - [ ] Optionally link promos to drops or channels (e.g. send to Telegram channel on approval)

=====================================================================
CRON / WORKERS
=====================================================================

/workers/cron/expireDrops.ts
  - [ ] Mark expired drops as completed

/workers/cron/metricsSnapshot.ts
  - [ ] Store metrics snapshot nightly

=====================================================================
FRONTEND (KEY FILES)
=====================================================================

/frontend/pages/support-tos.html
  - [ ] Already contains static legal/support content
  - [ ] Ensure:
        - footer includes:
            - link back to https://gamblecodez.com
            - mailto:support@gamblecodez.com
        - all external links use target="_blank" where appropriate

/frontend/src/components/Footer.tsx
  - [ ] Add link:
        - Support / TOS / Privacy → "/support-tos"
  - [ ] Add:
        - Telegram link
        - Discord link
        - Cwallet link

/frontend/src/pages/admin/DropsDashboard.tsx
  - [ ] Admin view for drops (uses /admin/drops, /admin/dashboard/summary)

/frontend/src/pages/admin/PromosReview.tsx
  - [ ] Fetch:
        - GET /admin/promos?status=pending_review
  - [ ] UI:
        - list pending promos with all submitted fields
        - Approve / Reject buttons (PATCH /admin/promos/:id/approve|reject)
  - [ ] After approve:
        - optional: show link to “Create Drop from Promo”

/frontend/src/pages/submit-promo.html or .tsx
  - [ ] Quick form for users (same fields as bot flow):
        - Promo name
        - Promo link or code
        - Casino URL (base URL only)
        - VIP or wager requirements
        - Claimable: now / certain days / weekly / limited claims
  - [ ] On submit:
        - POST /v1/promos/submit
  - [ ] Confirmation message:
        - “Thanks degen, GCZ admin will review your promo.”

/frontend/src/pages/telegram-landing.tsx
  - [ ] Explain GCZ + telegram
  - [ ] Buttons for:
        - Open Bot
        - Open Mini App
        - Submit Promo (links to submit-promo or /submitpromo command)
        - Support / TOS

=====================================================================
DEPLOYMENT / OPS
=====================================================================

/Dockerfile
  - [ ] Multi-stage build
/docker-compose.yml or k8s/*
  - [ ] Wire backend, db, admin frontend
  - [ ] Health checks on /health

=====================================================================
FINAL CHECKLIST
=====================================================================

  - [ ] Migrations run successfully
  - [ ] /support-tos serves the static TOS page
  - [ ] Footer links appear on main site + TOS page
  - [ ] Telegram bot /submitpromo → creates promo row
  - [ ] Discord bot /submitpromo → creates promo row
  - [ ] Admin promos page → approve/reject promo
  - [ ] Approved promos visible (or directly used to define drops / channel posts)
  - [ ] Drops claim flow works from site, Telegram, Discord
  - [ ] Logs + metrics are clean and readable

=====================================================================
PROMO SUBMISSION → INSTANT PUBLISH + AI LEARNING
=====================================================================

/backend/src/routes/promos.ts
  - [ ] Modify POST /v1/promos/submit:
        - Validate payload
        - Normalize casino_base_url (strip query params)
        - Insert promo row with status='approved' (NOT pending)
        - Immediately:
            -> call promoPublisher.publishToSite(promo)
            -> call promoPublisher.publishToTelegram(promo)
            -> call promoPublisher.publishToDiscord(promo)
            -> enqueue promo for AI learning (promoAiQueue.enqueue(promo))
        - Return { success: true, promo_id }

/backend/src/services/promoService.ts
  - [ ] Add:
        - async approveAndPublish(promo):
            -> update status='approved'
            -> promoPublisher.publishToSite(promo)
            -> promoPublisher.publishToTelegram(promo)
            -> promoPublisher.publishToDiscord(promo)
            -> promoAiQueue.enqueue(promo)

/backend/src/services/promoPublisher.ts
  - [ ] New file:
        - publishToSite(promo):
            -> write promo to public JSON feed:
               /var/www/gamblecodez/public/promos.json
            -> OR call frontend rebuild hook if using static site
        - publishToTelegram(promo):
            -> send formatted HTML message to Telegram channel
            -> include:
                Promo Name
                Casino Base URL
                Code/Link
                Requirements
                Claimability
        - publishToDiscord(promo):
            -> send embed to Discord channel (optional)

/backend/src/services/promoAiQueue.ts
  - [ ] New file:
        - enqueue(promo):
            -> push promo JSON into queue table: ai_learning_queue
        - worker will process asynchronously

/backend/src/db/migrations/2025_02_ai_queue.sql
  - [ ] Create table ai_learning_queue:
        id (pk)
        promo_id (fk -> promos)
        payload_json (jsonb)
        processed (boolean default false)
        created_at
        processed_at

/backend/src/workers/aiLearningWorker.ts
  - [ ] New worker:
        - poll ai_learning_queue where processed=false
        - send payload_json to AI ingestion endpoint
        - mark processed=true
        - log success/failure

=====================================================================
TELEGRAM CHANNEL AUTO‑POSTING
=====================================================================

/backend/src/telegram/channelPublisher.ts
  - [ ] New file:
        - sendPromoToChannel(promo):
            -> format HTML:
                <b>{promo_name}</b>
                Casino: {casino_base_url}
                Code/Link: {promo_code_or_link}
                Requirements: {vip_or_wager_requirements}
                Claimability: {claim_rules}
            -> call Telegram sendMessage(channel_id, html)

/backend/src/telegram/bot.ts
  - [ ] Ensure admin command /approvepromo triggers:
        promoService.approveAndPublish(promo)

/backend/src/telegram/commands.ts
  - [ ] Add admin-only command:
        /approvepromo <id>
        /rejectpromo <id>

/backend/src/telegram/keyboards.ts
  - [ ] Add inline button:
        “Submit Promo” → opens webapp or /submitpromo flow

=====================================================================
DISCORD AUTO‑POSTING (OPTIONAL)
=====================================================================

/backend/src/discord/channelPublisher.ts
  - [ ] New file:
        - sendPromoEmbed(promo):
            -> embed with:
                title: promo_name
                url: casino_base_url
                fields:
                    - Code/Link
                    - Requirements
                    - Claimability

/backend/src/discord/commands.ts
  - [ ] Add admin slash command:
        /approvepromo <id>

/backend/src/discord/bot.ts
  - [ ] Wire approve command to promoService.approveAndPublish()

=====================================================================
FRONTEND SITE AUTO‑PUBLISH
=====================================================================

/frontend/public/promos.json
  - [ ] This file is auto-updated by backend:
        - Contains array of approved promos
        - Frontend reads this to display promos instantly

/frontend/src/pages/promos.tsx
  - [ ] Fetch promos.json
  - [ ] Render:
        - Promo Name
        - Casino Base URL
        - Code/Link
        - Requirements
        - Claimability

/frontend/src/components/Footer.tsx
  - [ ] Add link:
        - “Submit Promo” → /submit-promo.html

/frontend/pages/submit-promo.html
  - [ ] Form fields:
        - promo_name
        - promo_code_or_link
        - casino_base_url
        - vip_or_wager_requirements
        - claimability (dropdown)
  - [ ] POST to /v1/promos/submit
  - [ ] Show success message:
        “Promo submitted and published instantly.”

=====================================================================
AI LEARNING PIPELINE
=====================================================================

/backend/src/workers/aiLearningWorker.ts
  - [ ] Poll queue
  - [ ] Send promo JSON to AI ingestion endpoint
  - [ ] Mark processed=true

/backend/src/services/promoAiQueue.ts
  - [ ] enqueue(promo):
        -> insert into ai_learning_queue

/backend/src/db/migrations/2025_02_ai_queue.sql
  - [ ] Create ai_learning_queue table

=====================================================================
ADMIN PANEL
=====================================================================

/frontend/src/pages/admin/PromosReview.tsx
  - [ ] Show pending promos (if any)
  - [ ] Approve button → calls /admin/promos/:id/approve
  - [ ] Approve triggers:
        promoService.approveAndPublish()

/backend/src/admin/routes/promos.ts
  - [ ] PATCH /admin/promos/:id/approve
        -> promoService.approveAndPublish()
  - [ ] PATCH /admin/promos/:id/reject
        -> update status='rejected'