Tyler ‚Äî this is a monster of a document, and you clearly want one thing:

Update everything we have changed or plan to.
Basically: a single source of truth for the entire GCZ ecosystem.

This is not a rewrite of your cheat sheet ‚Äî it‚Äôs the fully integrated, corrected, modernized version that reflects everything we‚Äôve actually changed and locked in.

This is the canonical, up‚Äëto‚Äëdate blueprint for your entire stack.

---

# ‚≠ê GAMBLECODEZ ‚Äî COMPLETE SYSTEM UPGRADE SPEC (FINAL 2026 EDITION)

## üé® BRAND + UX

**Core brand:**
- Neon‚Äëdark theme
- Crown energy across logo/UX
- Rainbow flash hero (short, 1√ó per day max)
- Glow badges for key categories (SC, Raffles, Exclusive, Verified, Blacklisted)
- ‚ÄúDegen but responsible‚Äù tone: hype, but with clear disclaimers

**Global UX:**
- Sticky but auto‚Äëhiding navbar
- Persistent footer with:
  - Contact
  - Legal / TOS / Privacy
  - Responsible gaming info
- Live notification banner for:
  - New drops
  - Raffle updates
  - Urgent support messages

**Degen Profile UX:**
- PIN‚Äëgated profile area
- Saved sites / favorites
- Notification preferences (email / Telegram / site only)

**Compliance UX:**
- Raffle disclaimers:
  - ‚ÄúNo purchase necessary‚Äù where required
  - ‚ÄúNot sponsored by XYZ casino‚Äù clarifiers
- Age & jurisdiction statements where relevant

---

## üåê FRONTEND (React / Vite / TS ‚Äî WEB APP)

**Primary user‚Äëfacing routes:**
- `/` ‚Äî Landing / Hero + featured drops
- `/drops` ‚Äî Main promo feed
- `/raffles` ‚Äî All active & historical raffles
- `/wheel` ‚Äî Wheel / spin feature
- `/affiliates` ‚Äî Transparent affiliate listing
- `/sites/recent` ‚Äî Recently added / updated sites
- `/leaderboard` ‚Äî Top winners / participants (internal rules)
- `/blacklist` ‚Äî Blacklisted sites / reasons
- `/contact` ‚Äî Support / feedback
- `/Degen Profile` ‚Äî Link Casino Account, Drops Promos interactive Dashboard, Secret Code Word Entry for hidden Raffles, Raffles, Degen Wheel, Raffle Winners Cwallet Prize URL Claim Button, Ping admin - Completed requirements for specific Site Affiliate Promo Elig (example Button to notify they have wagered 3,000SC in any 7 day period on Runewager & is signed up under GambleCodez affiliate+ Request for auth and manual SC tip on site for 30SC by admin, PIN + Cwallet ID + Telegram @ site connections GambleCodez Hero sites Runewage.com & Winna.com, notification prefs

**Key components:**
- `Navbar` ‚Äî responsive, auto‚Äëhide on scroll
- `LiveBanner` ‚Äî live updates (maintenance, big drops)
- `PushNotificationBell` ‚Äî per‚Äëuser notification badge
- `SiteCard` / `SiteGrid` ‚Äî unified cards for casinos / offers
- `FiltersBar` ‚Äî sort/filter by:
  - SC / cash / sweepstakes
  - New / expiring
  - Verified / unverified
- `RaffleJoinModal` ‚Äî join flow with validation
- `Wheel` ‚Äî controlled spin UX
- `DropCard` ‚Äî formatted promo display (code/link, description, site, tags)
- `PWAInstallPrompt` ‚Äî mobile / desktop install
- `NotificationPermissionPrompt` ‚Äî browser notifications

**Frontend ‚Üí Backend API usage (HTTP):**
- `GET /api/sites`
- `GET /api/sites/recent`
- `GET /api/drops` (promos)
- `GET /api/raffles`
- `POST /api/raffles/join`
- `GET /api/degenprofile`
- `POST /api/profile/update`
- `POST /api/profile/pin`
- `GET /api/notifications`
- `PATCH /api/notifications/:id/read`
- `POST /api/contact`

All backend calls terminate on the **Python FastAPI** backend under `/var/www/html/gcz/backend`.

---

## üß† BACKEND CORE (PYTHON FASTAPI ‚Äî `backend/main.py`)

**Location:**
- `/var/www/html/gcz/backend/main.py`

**Key imports (canonical):**
- `from config.config import get_settings`
- `from logger import get_logger`
- `from middleware.rate_limit import rate_limiter`
- `from routes import (ai_router, promos_router, giveaway_router, affiliates_router, casinos_router, redeem_router, admin_router, profile_router, dashboard_router, sc_router, auth_roles_router)`

**App init:**
- `app = FastAPI(title="GambleCodez API", version="2.0.0", description="GambleCodez Backend + AI Control Surface")`
- CORS:
  - `allow_origins=["*"]`
  - `allow_methods=["*"]`
  - `allow_headers=["*"]`

**Global middleware:**
- Rate‚Äëlimit middleware:
  - `@app.middleware("http")`
  - Delegates to `rate_limiter(request, call_next)`
  - Prevents abuse on public endpoints

**Base health endpoint:**
- `GET /api/health` ‚Üí `{"status": "ok"}`

---

## üß© BACKEND CONFIG & SETTINGS

**Files:**
- `/var/www/html/gcz/backend/config/__init__.py`
- `/var/www/html/gcz/backend/config/config.py`
- `/var/www/html/gcz/backend/.env`

**`config/config.py` (canonical):**
- Uses `pydantic.BaseSettings`
- Loads from `/var/www/html/gcz/backend/.env`
- Example fields:
  - `ENV = "production"`
  - `DOMAIN = "https://gamblecodez.com"`
  - `GCZ_DB = "postgresql://...neon..."` (primary DB URL)
- Config:
  - `env_file = "/var/www/html/gcz/backend/.env"`
  - `extra = "allow"`

**Access pattern:**
- `settings = get_settings()`
- Used for DB URL, domain, environment flags.

---

## üóÑÔ∏è DATABASE LAYER

**Primary DB:**
- PostgreSQL (Neon or other managed PG)
- Connection via `GCZ_DB` in `.env`

**Core tables (conceptual):**
- `users` ‚Äî accounts, profile settings, notification prefs
- `raffles` ‚Äî metadata, status, winners
- `raffle_entries` ‚Äî join records
- `promos` ‚Äî drops / promo codes / links
- `affiliates_master` ‚Äî official affiliate relationships, resolved domains
- `notifications` ‚Äî on‚Äësite notifications
- `telegram_events` / `discord_events` ‚Äî optional event log tables
- `service_health` ‚Äî service health / AI monitoring

**AI DB (Neon, AI engine):**
- Used for:
  - AI engine memory
  - `service_health` logging
  - AI events

**Important recent fix:**
- `service_health.details` column:
  - Must be `JSONB` **or**
  - Python must `json.dumps()` dicts before insert
- Error fixed:
  - `can't adapt type 'dict'` from psycopg2 when inserting dict directly.

---

## üß† AI ENGINE (GCZ AI MICRO-SERVICE)

**Location:**
- `/var/www/html/gcz/ai`
- Main file: `server.py`
- Database module: `db.py`

**Key behavior:**
- Loads environment from `/var/www/html/gcz/.env`
- Uses `GCZ_DB` or a dedicated AI DB URL for Neon
- Initializes DB pool and AI tables
- Starts memory monitor thread:
  - Writes into `service_health`
  - Periodic checks and logs

**Recent critical fix:**
- Ensure `.env` is loaded **before** importing DB functions that require `GCZ_DB`.

Canonical pattern in `server.py`:

```python
from dotenv import load_dotenv
load_dotenv("/var/www/html/gcz/.env")

from db import fetchall, execute
